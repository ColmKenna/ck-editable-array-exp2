<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React Example - ck-editable-array</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1100px;
      margin: 2rem auto;
      padding: 0 1rem;
      background: #f5f5f5;
    }

    .header {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      margin: 0 0 0.5rem 0;
      color: #2c3e50;
    }

    .subtitle {
      color: #7f8c8d;
      margin: 0;
    }

    .card {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .back-link {
      display: inline-block;
      margin-bottom: 1rem;
      color: #3498db;
      text-decoration: none;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    pre {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 1.5rem;
      border-radius: 4px;
      overflow-x: auto;
      line-height: 1.5;
    }

    code {
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }

    .alert {
      background: #d1ecf1;
      border-left: 4px solid #0c5460;
      padding: 1rem;
      border-radius: 4px;
      margin-bottom: 1.5rem;
      color: #0c5460;
    }

    h2 {
      color: #2c3e50;
      border-bottom: 2px solid #ecf0f1;
      padding-bottom: 0.5rem;
      margin-top: 2rem;
    }

    h3 {
      color: #34495e;
      margin-top: 1.5rem;
    }

    ol {
      line-height: 1.8;
    }

    .step {
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <a href="ck-editable-array-help.html" class="back-link">← Back to Documentation</a>

  <div class="header">
    <h1>React Example</h1>
    <p class="subtitle">Using ck-editable-array in React applications</p>
  </div>

  <div class="card">
    <div class="alert">
      <strong>Note:</strong> This page demonstrates how to integrate the ck-editable-array component
      in React applications. Web components work seamlessly with React using refs.
    </div>

    <h2>Installation</h2>
    <pre><code>npm install @colmkenna/ck-webcomponents</code></pre>

    <h2>TypeScript Declarations</h2>
    <p>For TypeScript users, add type declarations for the custom element:</p>
    <pre><code>// src/types/ck-editable-array.d.ts
import { CkEditableArray } from '@colmkenna/ck-webcomponents';

declare global {
  namespace JSX {
    interface IntrinsicElements {
      'ck-editable-array': React.DetailedHTMLProps&lt;
        React.HTMLAttributes&lt;CkEditableArray&gt; & {
          id?: string;
          name?: string;
          color?: string;
          readonly?: boolean;
          'modal-edit'?: boolean;
          ref?: React.Ref&lt;CkEditableArray&gt;;
        },
        CkEditableArray
      &gt;;
    }
  }
}</code></pre>

    <h2>Basic Component Example</h2>
    <pre><code>// src/components/UserList.tsx
import React, { useRef, useEffect, useState } from 'react';
import '@colmkenna/ck-webcomponents';

interface User {
  id: number;
  name: string;
  email: string;
  deleted?: boolean;
}

const UserList: React.FC = () => {
  const listRef = useRef&lt;any&gt;(null);
  const [users, setUsers] = useState&lt;User[]&gt;([
    { id: 1, name: 'Alice Johnson', email: 'alice@example.com' },
    { id: 2, name: 'Bob Smith', email: 'bob@example.com' }
  ]);

  useEffect(() => {
    if (listRef.current) {
      // Set initial data
      listRef.current.data = users;

      // Configure new item factory
      listRef.current.newItemFactory = () => ({
        id: Date.now(),
        name: '',
        email: ''
      });

      // Listen for data changes
      const handleDataChange = (e: CustomEvent) => {
        console.log('Data changed:', e.detail.data);
        setUsers(e.detail.data);
      };

      listRef.current.addEventListener('datachanged', handleDataChange);

      // Cleanup
      return () => {
        listRef.current?.removeEventListener('datachanged', handleDataChange);
      };
    }
  }, []);

  const handleAddUser = () => {
    listRef.current?.addRow();
  };

  return (
    &lt;div className="container"&gt;
      &lt;h1&gt;User Management&lt;/h1&gt;

      &lt;button onClick={handleAddUser} className="btn btn-primary"&gt;
        Add User
      &lt;/button&gt;

      &lt;ck-editable-array ref={listRef} name="users"&gt;
        &lt;template data-slot="display"&gt;
          &lt;div className="row-display"&gt;
            &lt;div className="flex-grow"&gt;
              &lt;strong data-bind="name"&gt;&lt;/strong&gt;
              &lt;span className="text-muted ms-2" data-bind="email"&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div&gt;
              &lt;button data-action="toggle" className="btn btn-sm btn-secondary"&gt;
                Edit
              &lt;/button&gt;
              &lt;button data-action="delete" className="btn btn-sm btn-danger"&gt;
                Delete
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/template&gt;

        &lt;template data-slot="edit"&gt;
          &lt;div className="edit-panel"&gt;
            &lt;div className="mb-3"&gt;
              &lt;label className="form-label"&gt;Name&lt;/label&gt;
              &lt;input type="text" data-bind="name" className="form-input" /&gt;
            &lt;/div&gt;
            &lt;div className="mb-3"&gt;
              &lt;label className="form-label"&gt;Email&lt;/label&gt;
              &lt;input type="email" data-bind="email" className="form-input" /&gt;
            &lt;/div&gt;
            &lt;div&gt;
              &lt;button data-action="cancel" className="btn btn-secondary"&gt;
                Cancel
              &lt;/button&gt;
              &lt;button data-action="save" className="btn btn-success"&gt;
                Save
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/template&gt;
      &lt;/ck-editable-array&gt;
    &lt;/div&gt;
  );
};

export default UserList;</code></pre>

    <h2>With Validation Example</h2>
    <pre><code>// src/components/ValidatedUserList.tsx
import React, { useRef, useEffect, useState } from 'react';
import '@colmkenna/ck-webcomponents';

interface User {
  username: string;
  email: string;
  role: string;
}

const ValidatedUserList: React.FC = () => {
  const listRef = useRef&lt;any&gt;(null);
  const [users, setUsers] = useState&lt;User[]&gt;([]);

  useEffect(() => {
    if (listRef.current) {
      // Define validation schema
      listRef.current.validationSchema = {
        username: {
          required: true,
          minLength: 3,
          maxLength: 20,
          pattern: /^[a-zA-Z0-9_]+$/
        },
        email: {
          required: true,
          pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/
        },
        role: {
          required: true,
          custom: (value: string) => {
            return ['admin', 'editor', 'viewer'].includes(value);
          }
        }
      };

      // Configure factory
      listRef.current.newItemFactory = () => ({
        username: '',
        email: '',
        role: ''
      });

      // Set initial data
      listRef.current.data = [
        { username: 'admin', email: 'admin@example.com', role: 'admin' }
      ];

      // Handle data changes
      const handleDataChange = (e: CustomEvent) => {
        setUsers(e.detail.data);
      };

      listRef.current.addEventListener('datachanged', handleDataChange);

      return () => {
        listRef.current?.removeEventListener('datachanged', handleDataChange);
      };
    }
  }, []);

  return (
    &lt;div className="container"&gt;
      &lt;h1&gt;Validated User Form&lt;/h1&gt;

      &lt;ck-editable-array ref={listRef} name="users"&gt;
        &lt;template data-slot="display"&gt;
          &lt;div className="row-display"&gt;
            &lt;div&gt;
              &lt;strong data-bind="username"&gt;&lt;/strong&gt; -
              &lt;span data-bind="role"&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;button data-action="toggle"&gt;Edit&lt;/button&gt;
          &lt;/div&gt;
        &lt;/template&gt;

        &lt;template data-slot="edit"&gt;
          &lt;div className="edit-panel"&gt;
            &lt;div data-error-summary&gt;&lt;/div&gt;

            &lt;div&gt;
              &lt;label&gt;Username&lt;/label&gt;
              &lt;input type="text" data-bind="username" /&gt;
              &lt;span data-field-error="username"&gt;&lt;/span&gt;
            &lt;/div&gt;

            &lt;div&gt;
              &lt;label&gt;Email&lt;/label&gt;
              &lt;input type="email" data-bind="email" /&gt;
              &lt;span data-field-error="email"&gt;&lt;/span&gt;
            &lt;/div&gt;

            &lt;div&gt;
              &lt;label&gt;Role&lt;/label&gt;
              &lt;select data-bind="role"&gt;
                &lt;option value=""&gt;Select...&lt;/option&gt;
                &lt;option value="admin"&gt;Admin&lt;/option&gt;
                &lt;option value="editor"&gt;Editor&lt;/option&gt;
                &lt;option value="viewer"&gt;Viewer&lt;/option&gt;
              &lt;/select&gt;
              &lt;span data-field-error="role"&gt;&lt;/span&gt;
            &lt;/div&gt;

            &lt;button data-action="save"&gt;Save&lt;/button&gt;
            &lt;button data-action="cancel"&gt;Cancel&lt;/button&gt;
          &lt;/div&gt;
        &lt;/template&gt;
      &lt;/ck-editable-array&gt;
    &lt;/div&gt;
  );
};

export default ValidatedUserList;</code></pre>

    <h2>Custom Hook Example</h2>
    <p>Create a reusable hook for managing the component:</p>
    <pre><code>// src/hooks/useEditableArray.ts
import { useRef, useEffect, useState } from 'react';

interface UseEditableArrayOptions&lt;T&gt; {
  initialData?: T[];
  factory: () => T;
  validationSchema?: Record&lt;string, any&gt;;
  onChange?: (data: T[]) => void;
}

export function useEditableArray&lt;T&gt;(options: UseEditableArrayOptions&lt;T&gt;) {
  const listRef = useRef&lt;any&gt;(null);
  const [data, setData] = useState&lt;T[]&gt;(options.initialData || []);

  useEffect(() => {
    if (listRef.current) {
      // Set initial data
      listRef.current.data = options.initialData || [];

      // Configure factory
      listRef.current.newItemFactory = options.factory;

      // Configure validation
      if (options.validationSchema) {
        listRef.current.validationSchema = options.validationSchema;
      }

      // Handle data changes
      const handleDataChange = (e: CustomEvent) => {
        const newData = e.detail.data;
        setData(newData);
        options.onChange?.(newData);
      };

      listRef.current.addEventListener('datachanged', handleDataChange);

      return () => {
        listRef.current?.removeEventListener('datachanged', handleDataChange);
      };
    }
  }, []);

  const addRow = () => {
    listRef.current?.addRow();
  };

  const deleteRow = (index: number) => {
    listRef.current?.deleteRow(index);
  };

  const restoreRow = (index: number) => {
    listRef.current?.restoreRow(index);
  };

  return {
    listRef,
    data,
    addRow,
    deleteRow,
    restoreRow
  };
}

// Usage:
function MyComponent() {
  const { listRef, data, addRow } = useEditableArray({
    initialData: [{ name: 'Test', email: 'test@example.com' }],
    factory: () => ({ name: '', email: '' }),
    onChange: (data) => console.log('Data changed:', data)
  });

  return (
    &lt;div&gt;
      &lt;button onClick={addRow}&gt;Add&lt;/button&gt;
      &lt;ck-editable-array ref={listRef}&gt;
        {/* templates */}
      &lt;/ck-editable-array&gt;
    &lt;/div&gt;
  );
}</code></pre>

    <h2>Best Practices</h2>
    <ol>
      <li>
        <strong>Use Refs:</strong> Always use refs to access the component's properties and methods
      </li>
      <li>
        <strong>Event Listeners:</strong> Set up event listeners in useEffect and clean them up on unmount
      </li>
      <li>
        <strong>State Management:</strong> Keep React state in sync with component data via the datachanged event
      </li>
      <li>
        <strong>Type Safety:</strong> Use TypeScript interfaces to define your data structure
      </li>
      <li>
        <strong>Custom Hooks:</strong> Create reusable hooks to encapsulate common patterns
      </li>
      <li>
        <strong>Template Syntax:</strong> Use standard HTML in templates, not JSX syntax
      </li>
    </ol>

    <h2>Common Issues</h2>

    <h3>Templates Not Rendering</h3>
    <p>
      Make sure templates are direct children of the web component and use standard HTML syntax (not JSX):
    </p>
    <pre><code>&lt;!-- ✗ Wrong (JSX className in template) --&gt;
&lt;template data-slot="display"&gt;
  &lt;div className="row"&gt;...&lt;/div&gt;
&lt;/template&gt;

&lt;!-- ✓ Correct (HTML class in template) --&gt;
&lt;template data-slot="display"&gt;
  &lt;div class="row"&gt;...&lt;/div&gt;
&lt;/template&gt;</code></pre>

    <h3>Ref Type Errors</h3>
    <p>
      If you get TypeScript errors with refs, use <code>any</code> or create proper type declarations
      as shown in the TypeScript section above.
    </p>
  </div>
</body>
</html>