<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal Edit Mode - ck-editable-array</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <a href="index.html" class="back-link">← Back to Examples</a>
      <h1>Modal Edit Mode</h1>
      <p class="subtitle">Edit items in a modal dialog instead of inline.</p>
    </header>

    <div class="card">
      <div class="warning-box" style="background: #dbeafe; border-color: #3b82f6;">
        <strong>Feature:</strong> When <code>modal-edit</code> attribute is set, clicking "Edit" opens a modal dialog for editing instead of showing inline edit controls.
      </div>

      <div class="mb-4 flex-row justify-end">
        <button id="addBtn" class="demo-btn">Add Product</button>
      </div>

      <!-- Note: modal-edit attribute enables modal editing mode -->
      <ck-editable-array id="modalList" modal-edit>
        <template data-slot="display">
          <link rel="stylesheet" href="styles.css">
          <div class="row-item">
            <div class="grow">
              <div style="font-weight: 600; font-size: 1.1rem;" data-bind="name"></div>
              <div class="text-sm text-muted">
                <span data-bind="category"></span> •
                <span style="font-weight: 600; color: #059669;">$<span data-bind="price"></span></span>
              </div>
            </div>
            <div class="flex-row gap-2" style="width: auto;">
              <button data-action="toggle" class="demo-btn btn-secondary">Edit</button>
              <button data-action="delete" class="demo-btn btn-danger">Delete</button>
              <button data-action="restore" class="demo-btn btn-restore">Restore</button>
            </div>
          </div>
        </template>

        <template data-slot="edit">
          <link rel="stylesheet" href="styles.css">
          <div class="edit-panel vertical">
            <h3 style="margin: 0 0 1rem 0;">Edit Product</h3>

            <div data-error-summary></div>

            <div class="flex-col gap-3">
              <div>
                <label class="form-label">Product Name *</label>
                <input type="text" data-bind="name" placeholder="Enter product name" class="form-input">
                <span data-field-error="name"></span>
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                  <label class="form-label">Category *</label>
                  <select data-bind="category" class="form-input">
                    <option value="">Select category...</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Clothing">Clothing</option>
                    <option value="Books">Books</option>
                    <option value="Home">Home</option>
                  </select>
                  <span data-field-error="category"></span>
                </div>

                <div>
                  <label class="form-label">Price *</label>
                  <input type="number" data-bind="price" placeholder="0.00" step="0.01" min="0" class="form-input">
                  <span data-field-error="price"></span>
                </div>
              </div>

              <div>
                <label class="form-label">Description</label>
                <textarea data-bind="description" placeholder="Enter product description" class="form-input" rows="3"></textarea>
                <span data-field-error="description"></span>
              </div>
            </div>

            <div class="flex-row gap-2 justify-end mt-3">
              <button data-action="cancel" class="demo-btn btn-neutral">Cancel</button>
              <button data-action="save" class="demo-btn btn-success">Save Changes</button>
            </div>
          </div>
        </template>
      </ck-editable-array>
    </div>

    <div class="card">
      <h2>Controls</h2>
      <label class="flex-row gap-2" style="cursor: pointer; width: auto;">
        <input type="checkbox" id="toggleModal" checked>
        Enable Modal Edit Mode
      </label>
      <p class="text-sm text-muted" style="margin-top: 0.5rem;">
        When disabled, items will be edited inline. When enabled, items will be edited in a modal dialog.
      </p>
    </div>

    <div class="card">
      <h2>Component Data</h2>
      <pre id="output" class="code-output">[]</pre>
    </div>
  </div>

  <script type="module">
    import '../dist/ck-editable-array/ck-editable-array.esm.js';

    const list = document.getElementById('modalList');
    const addBtn = document.getElementById('addBtn');
    const toggle = document.getElementById('toggleModal');
    const output = document.getElementById('output');

    // Define validation schema
    list.validationSchema = {
      name: {
        required: true,
        minLength: 3,
        maxLength: 100
      },
      category: {
        required: true
      },
      price: {
        required: true,
        custom: (val) => {
          const num = parseFloat(val);
          return !isNaN(num) && num >= 0;
        }
      }
    };

    // Factory for new items
    list.newItemFactory = () => ({
      name: '',
      category: '',
      price: '',
      description: ''
    });

    // Initial data
    list.data = [
      {
        name: 'Wireless Headphones',
        category: 'Electronics',
        price: '79.99',
        description: 'High-quality wireless headphones with noise cancellation'
      },
      {
        name: 'Cotton T-Shirt',
        category: 'Clothing',
        price: '24.99',
        description: 'Comfortable cotton t-shirt in various colors'
      },
      {
        name: 'JavaScript Guide',
        category: 'Books',
        price: '39.99',
        description: 'Complete guide to modern JavaScript development'
      }
    ];

    // Handle add button
    addBtn.addEventListener('click', () => {
      list.addRow();
    });

    // Toggle modal mode
    toggle.addEventListener('change', (e) => {
      list.modalEdit = e.target.checked;
    });

    // Listen for data changes
    list.addEventListener('datachanged', (e) => {
      output.textContent = JSON.stringify(e.detail.data, null, 2);
    });

    // Log events for demonstration
    ['beforetogglemode', 'aftertogglemode'].forEach(evt => {
      list.addEventListener(evt, (e) => {
        console.log(`${evt}:`, e.detail);
      });
    });

    // Initial output
    output.textContent = JSON.stringify(list.data, null, 2);
  </script>
</body>
</html>
